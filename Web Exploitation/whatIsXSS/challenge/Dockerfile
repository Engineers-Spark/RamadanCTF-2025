FROM nginx:alpine

# Copy the challenge files to the nginx web root
COPY index.html /usr/share/nginx/html/
COPY style.css /usr/share/nginx/html/
COPY script.js /usr/share/nginx/html/

# Create custom Nginx config to listen on port 5050
RUN echo 'server { \
    listen 4001; \
    location / { \
        root /usr/share/nginx/html; \
        index index.html; \
    } \
    # Block access to any potential flag.txt \
    location ~ .*flag.* { \
        deny all; \
        return 404; \
    } \
}' > /etc/nginx/conf.d/default.conf

# Store the real flag in a non-web accessible location
RUN mkdir -p /opt/flags && \
    echo "Spark{Y0u_N33d_t0_l34Rn_XSS!!!!!}" > /opt/flags/real_flag.txt && \
    chmod 400 /opt/flags/real_flag.txt

# Expose port 4001
EXPOSE 4001

# Start nginx
CMD ["nginx", "-g", "daemon off;"]
