from ubuntu:latest

RUN apt-get update && apt-get install -y docker.io openssh-server 

RUN mkdir /docker_setup
WORKDIR /docker_setup




COPY Dockerfile.child ./Dockerfile
COPY cats.c .
COPY super_hyper_meow.c .
USER root

#SSH
RUN mkdir /var/run/sshd
RUN ssh-keygen -A # <-- Generates missing SSH host keys
RUN service ssh start

RUN sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config


RUN echo "PasswordAuthentication yes" >> /etc/ssh/sshd_config

RUN ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 # <-- creating sshkey


EXPOSE 5004
CMD dockerd & sleep 5 &&docker build -t child_container . &&docker run -p 5004:22 child_container 
